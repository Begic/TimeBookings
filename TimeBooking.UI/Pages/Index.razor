@page "/"
@using System.Security

@inject IUserProvider UserProvider
@inject ITimeBookingProvider TimeBookingProvider
@inject ISnackbar Toaster

<PageTitle>Übersicht</PageTitle>

<LoadingPage IsLoading="@(alluserinfos == null || allTimeBookings == null)">
    <DefaultLayout Title="Übersicht">
        <Actions>
            <MudTooltip Text="Einstempeln">
                <MudButton Color="@Color.Success" ButtonType="@ButtonType.Button" Variant="@Variant.Filled" OnClick="@OnClickStartTimeBooking" EndIcon="@Icons.Material.Filled.AddCircle">Einstempeln</MudButton>
            </MudTooltip>
            <MudTooltip Text="Ausstempeln">
                <MudButton Color="@Color.Info" ButtonType="@ButtonType.Button" Variant="@Variant.Filled" OnClick="@OnClickEndTimeBooking" EndIcon="@Icons.Material.Filled.AddCircle">Ausstempeln</MudButton>
            </MudTooltip>
        </Actions>
        <Content>
            <MudDataGrid Items="@allTimeBookings"
                         RowsPerPage="10"
                         Dense="@true"
                         Striped="@true"
                         Hover="@true"
                         Virtualize="@true">
                <Columns>
                    <PropertyColumn Title="Tag" Property="@(x => x.BookingDay)"/>
                    <PropertyColumn Title="Kommentar" Property="@(x => x.Remark)"/>
                    <TemplateColumn>
                        <CellTemplate>
                            <MudStack Row>
                                <MudTooltip Text="Bearbeiten">
                                    <MudFab Size="Size.Small" IconSize="Size.Small" Color="Color.Warning" StartIcon="@Icons.Material.Filled.Edit" OnClick="() => OnClickEdit(context.Item)"/>
                                </MudTooltip>
                                <MudTooltip Text="Löschen">
                                    <MudFab Size="Size.Small" IconSize="Size.Small" Color="Color.Error" StartIcon="@Icons.Material.Filled.Delete" OnClick="() => OnDelete(context.Item)"/>
                                </MudTooltip>
                            </MudStack>
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>
            </MudDataGrid>
        </Content>
    </DefaultLayout>
</LoadingPage>


@code
{
    private List<UserInfo> alluserinfos;
    private UserInfo? currentUser;
    private List<TimeBookingDayInfo> allTimeBookings;

    protected override async Task OnInitializedAsync()
    {
        alluserinfos = await UserProvider.GetAllUserInfos();
        currentUser = alluserinfos.FirstOrDefault();

        await LoadTimeBookings();
    }

    private async Task LoadTimeBookings()
    {
        allTimeBookings = await TimeBookingProvider.GetAllTimeBookings();
        if (currentUser != null)
        {
            allTimeBookings = allTimeBookings.Where(x => x.UserId == currentUser.Id).ToList();
        }
    }

    private void OnClickStartTimeBooking()
    {
    }

    private void OnClickEndTimeBooking()
    {
    }

    private void OnClickEdit(TimeBookingDayInfo? contextItem)
    {
    }

    private void OnDelete(TimeBookingDayInfo? contextItem)
    {
    }

}